local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local window = Rayfield:CreateWindow({
    Name = "Forsaken - Alpha Hax",
    LoadingTitle = "Loading Assets..",
    LoadingSubtitle = "Created By Luxx",
    ConfigurationSaving = {
        Enabled = false,
        FileName = "Sirius"
    },
    KeySystem = true,
    KeySettings = {
        Title = "Luxx's Key System",
        Subtitle = "Enter Your Key",
        Note = "Rate The Features",
        FileName = "Sirius",
        SaveKey = false,
        Key = "2025"
    }
})

local generatorsSection = generatorsTab:CreateSection("Generators")

_G.AutoGeneratorsEnabled = false
local generatorInterval = 7

local function findNearestGenerator()
    local player = game.Players.LocalPlayer
    local character = player.Character
    if not character then return nil end

    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart then return nil end

    local generatorFolder = workspace:WaitForChild("Map"):WaitForChild("Ingame"):WaitForChild("Map")
    local nearest, minDistance = nil, math.huge

    for _, obj in pairs(generatorFolder:GetChildren()) do
        if obj.Name == "Generator" and obj:FindFirstChild("Remotes") then
            local distance = (rootPart.Position - obj:GetPivot().Position).Magnitude
            if distance < minDistance then
                minDistance = distance
                nearest = obj
            end
        end
    end

    return nearest
end

local function startGeneratorAutoComplete()
    spawn(function()
        while _G.AutoGeneratorsEnabled do
            local playerGui = game.Players.LocalPlayer:WaitForChild("PlayerGui")
            local puzzleUI = playerGui:FindFirstChild("PuzzleUI")

            if puzzleUI then
                local generator = findNearestGenerator()
                if generator then
                    local remotes = generator:FindFirstChild("Remotes")
                    local remoteEvent = remotes and remotes:FindFirstChild("RE")
                    if remoteEvent then
                        remoteEvent:FireServer()
                    end
                end
            end

            wait(generatorInterval)
        end
    end)
end

generatorsTab:CreateToggle({
    Name = "Auto Complete Generators",
    CurrentValue = false,
    SectionParent = generatorsSection,
    Callback = function(state)
        _G.AutoGeneratorsEnabled = state

        Rayfield:Notify({
            Title = "Auto Generator",
            Content = state and "Auto Complete Enabled" or "Auto Complete Disabled",
            Duration = 3,
            Image = 4483362458
        })

        if state then
            startGeneratorAutoComplete()
        end
    end
})

local espSection = generatorsTab:CreateSection("ESP")

_G.ESPGeneratorsEnabled = false
local activeHighlights = {}
local espLoops = {}

local function startESPGenerators()
    local mapFolder = workspace:FindFirstChild("Map")
    if not mapFolder then return end

    local ingameFolder = mapFolder:FindFirstChild("Ingame")
    if not ingameFolder then return end

    for _, obj in pairs(ingameFolder:GetChildren()) do
        if obj.Name == "Generator" and obj:IsA("Model") then
            local progress = obj:FindFirstChild("Progress")
            if progress and progress:IsA("BoolValue") then
                local highlight = Instance.new("Highlight")
                highlight.Adornee = obj
                highlight.FillColor = Color3.fromRGB(255, 255, 0)
                highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                highlight.Parent = obj
                activeHighlights[obj] = highlight

                local loop = coroutine.create(function()
                    while _G.ESPGeneratorsEnabled do
                        if progress.Value == true then
                            if activeHighlights[obj] then
                                activeHighlights[obj]:Destroy()
                                activeHighlights[obj] = nil
                            end
                            break
                        end
                        task.wait()
                    end
                end)

                coroutine.resume(loop)
                espLoops[obj] = loop
            end
        end
    end
end

local function stopESPGenerators()
    for obj, highlight in pairs(activeHighlights) do
        if highlight then
            highlight:Destroy()
        end
    end
    activeHighlights = {}

    for obj, loop in pairs(espLoops) do
        espLoops[obj] = nil
    end
end

generatorsTab:CreateToggle({
    Name = "ESP Generators",
    CurrentValue = false,
    SectionParent = espSection,
    Callback = function(state)
        _G.ESPGeneratorsEnabled = state

        Rayfield:Notify({
            Title = "ESP Toggle",
            Content = state and "ESP Generators Enabled" or "ESP Generators Disabled",
            Duration = 3,
            Image = 4483362458
        })

        if state then
            startESPGenerators()
        else
            stopESPGenerators()
        end
    end
})
